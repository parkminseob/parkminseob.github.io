---
title: 모두의 네트워크 Chap5 - 네트워크 계층 
layout: single
author_profile: true
read_time: true
categories:
- network
toc: true
toc_sticky: true
toc_label: on this page
tags:
  - network
---



## 네트워크 계층의 역할

### 네트워크 간의 연결 구조

네트워크 계층 역할은 네트워크 간의 통신을 가능하게 하는 것이다. 이 계층을 통해 다른 네트워크로 데이터를 전송하려면 라우터(router)라는 네트워크 장비가 필요하다.

> 데이터 링크 계층에 스위치가 있어 네트워크 환경이 문제없이 구성이 잘 되어있지만, 데이터 링크 계층만의 기능으로는 해당 네트워크 안에서만 통신이 가능하다.



**라우터란?**

데이터의 목적지가 정해지만 해당 목적지까지 어떤 경로로 가는 것이 좋은 지를 알려주는 기능을 한다. 라우터가 데이터를 보내려면 해당 목적지의 주소를 반드시 알아야 한다.

예를 들어, 우편물을 보내는데 목적지 주소를 모르면 물건을 배송할 수 없을 것이다. 이처럼 네트워크에서도 데이터를 보낼 수 있는 목적지 주소를 **IP주소**라고 한다.

데이터를 보낼때는 IP주소로 원하는 목적지를 지정하고, 데이터를 어떤 경로로 보낼지도 결정해야한다. 이처럼 목적지 IP주소까지 어떤 경로로 데이터를 보낼 지 결정하는 것을 **라우팅(routing)**이라고 한다.

>  라우터를 사용하여 거리에 관계없이 다른 네트워크로 데이터를 보낼 수 있다. 라우터에는 라우팅 테이블(routing table)이 있어 경로 정보를 등록하고 관리한다.



### IP(Internet Protocol)란?

- 어떤 네트워크의 어떤 컴퓨터인지 식별할 수 있도록 부여하는 주소이다.
- 네트워크 계층에 있는 프로토콜이다.
- 네트워크 계층에서 캡슐화 할때 IP헤더를 붙인다. IP헤더에는 데이터를 정확하게 전달하기 위해 필요한 정보가 포함되어 있다. 많은 정보가 들어있는데, **"출발지 IP주소"**와 **"목적지 IP주소"**가 들어있다는 것은 꼭 기억하자. 
- IP프로토콜을 사용하여 캡슐화 할 때 데이터에 IP헤더가 추가된다. 이 IP헤더를 **IP패킷**이라고 한다.



## IP 주소의 구조

IP주소는 인터넷 서비스 제공자(ISP)에게 받을 수 있다. Ip버전은 IPv4와 IPv6이 있다.

1. Ipv4
   - 32비트로 되어있어 Ip주소를 **약 43억개** 만들 수 있다.
   - 처음 Ip주소를 만들 때는 전세계에 43억개만 충분하다고 생각했으나, 인터넷이 널리 보급되면서 Ip주소가 부족해졌고 그러면서 Ipv6가 등장했다.
2. Ipv6
   - 128비트로 되어있고 Ip주소를 약 340간개를 만들 수 있다.
   - 간 단위는 천,억,조,경보다 훨씬 큰 숫자 단위로 앞으로는 Ip주소가 부족할 일은 없을 것이다.
   - 그러나 당분간은 Ipv4와 Ipv6이 공존해서 사용된다.

> 참고
>
> Ipv6를 사용하게 됨으로서 사실상 무제한의 Ip주소를 사용할 수 있게 되었고, 가정에 있는 Tv나 에어컨에도 인터넷을 연결하여 통신할 수 있게 된것이 바로 Ipv6의 보급 덕분이다.



#### Ip주소의 종류

Ipv4주소는 갈수록 사용할 수 있는 주소가 고갈되고 있다. 그래서 아래의 방법을 사용한다.

1. 공인 Ip주소 : 인터넷에 직접 연결되는 컴퓨터나 라우터에 할당한다.
2. 사설 Ip주소 : 회사나 가정의 랜에 있는 컴퓨터에 할당한다.

즉, 인터넷 서비스 공급자가 제공하는 공인 Ip주소는 라우터에만 할당하고 랜 안에 있는 컴퓨터에는 랜의 네트워크 관리자가 자유롭게 사설 Ip주소를 할당하거나 라우터의 DHCP기능을 사용하여 주소를 자동으로 할당하고 있다. => 공인Ip주소가 절약된다.

공인 Ip주소와 사설 Ip주소는 모두 2진수의 32비트를 동일하게 사용한다.

> DHCP란?
>
> Dynamic Host Configuration Protocol의 약자로 Ip주소를 자동으로 할당하는 프로토콜을 말한다.



Ip주소는 32비트로 구분하기 쉽도록 사람이 이해하기 쉽도록 8비트 단위로 나눈 다음 다시 10진수로 표시한다.

```
// 32비트를 그대로 표현할때
11000000101010000000000100001010

// 위 숫자를 다시 8비트로 나눈다. 8비트 단위는 1옥텟(octet)이라고 부른다.
11000000 10101000 00000001 00001010

// 조금 더 읽기 쉽도록 10진수로 변환한다.
192 168 1 10
```

8비트 숫자의 범위는 00000000부터 11111111까지로, 10진수로 표현하면 0부터 255까지이다.



IP주소는 네트워크Id와 호스트 Id로 나누어져 있다.

1. **네트워크 ID** : 어떤 네트워크인지를 나타낸다.
2. **호스트 ID** : 해당 네트워크의 어느 컴퓨터인지를 나타낸다.

이 두개의 정보가 합쳐져서 Ip주소가 된다.



## Ip주소의 클래스 구조

잘 설명된 블로그 주소를 첨부한다. 너무나 잘 정리되어있어서 내가 더 적을 것이 없다.

[Ip주소의 클래스 구조를 설명한 블로그](https://limkydev.tistory.com/168)



## 네트워크 주소와 브로드캐스트 주소란?

Ip주소는 네트워크 주소와 브로드캐스트 주소도 있다. 이 두개의 주소는 특별한 주소로 컴퓨터나 라우터가 자신의 Ip 사용하면 안되는 주소이다!

- 네트워크 주소 : 호스트 ID가 10진수로 0이고, 2진수면 00000000인 주소이다.

  - 192.168.1.0
  - 앞의 24비트가 네트워크 Id, 뒤의 8비트가 호스트 ID이다.
  - 전체 네트워크에서 작은 네트워크를 식별하는 데 사용된다.
  - 쉽게 말해서 전체 네트워크의 대표 주소라고 생각하면 된다.

- 브로드캐스트 주소 : 호스트 ID가 10진수로 255고, 2진수면 11111111인 주소이다.

  - 192.168.1.255
  - 앞의 24비트가 네트워크 Id, 뒤의 8비트가 호스트 ID이다.
  - 네트워크에 있는 컴퓨터나 장비 모두에게 **한 번에 데이터를 전송**하는데 사용되는 전용 Ip주소이다.
  - 브로드캐스트 주소로 데이터를 전송하면 네트워크 안에 있는 모든 컴퓨터가 데이터를 받게 된다.

  

## 서브넷의 구조

많은 수의 컴퓨터가 브로드캐스트 패킷을 전송하면 모든 컴퓨터에 패킷이 전송되고 네트워크가 혼잡해질 수 있다. 

하지만 대규모의 네트워크를 작은 네트워크로 분할하여 브로드캐스트로 전송되는 패킷의 범위를 좁힐 수 있다. 이렇게 하면 더 많은 네트워크를 만들 수 있어 Ip주소를 효과적으로 활용할 수 있다.

![KakaoTalk_20201013_234333707](https://user-images.githubusercontent.com/68311188/95876431-00927180-0dae-11eb-84c4-579ce9f78685.jpg)

이처럼 네트워크를 분할하는 것을 서브넷팅(subneting)이라고 하고, 분할된 네트워크를 서브넷(subnet)이라고 한다.

네트워크를 서브넷팅하면 기존 네트워크Id와 호스트Id로 구성되어 있던 것이 **네트워크Id**, **서브넷Id**, **호스트Id**로 나누어지게 된다. 호스트 Id에서 비트를 빌려 서브넷Id로 만들 수 있다.



### 서브넷 마스크

위처럼 Ip주소를 서브넷팅하면 어디까지가 네트워크Id이고 호스트인지 판단하기 어려울때가 있다. 이 때 서브넷마스크를 사용한다.

- 서브넷 마스크란? : 네트워크 Id와 호스트Id를 식별하기 위한 값.

역시 서브넷 마스크를 설명한 블로그의 링크를 걸어두었다.

[서브넷 마스크를 설명한 블로그](https://limkydev.tistory.com/166?category=954021)



## 라우터의 구조

라우터는 네트워크를 분리할 수 있다.

네트워크를 분할한 뒤 컴퓨터 한대가 다른 네트워크로 접속하려 하는 경우,  그 네트워크에 데이터를 전송하기 위해 라우터의 Ip주소를 설정해야 한다. 이것은 네트워크의 출입구를 설정하는 것으로 **기본 게이트웨이(default gateway)라고 한다.



왜 라우터의 Ip주소를 지정해주어야 하는가?

컴퓨터는 다른 네트워크로 데이터를 보낼 때 어디로 전송해야 하는 지 알지 못한다. 그래서 네트워크의 출입구를 지정하고 일단은 라우터로 데이터를 전송한다. 윈도우 운영체제에는 기본적으로 '자동IP주소 받기'가 체크되어 있어 네트워크 외부에 접속할 때 기본 게이트웨이가 자동으로 설정된다.



### 라우팅

라우팅은 경로 정보를 기반으로 현재의 네트워크에서 다른 네트워크로 최적의 경로를 통해 데이터를 전송한다. 이 경로 정보가 등록되어 있는 테이블이 **라우팅 테이블**이다.

라우팅 테이블은 네트워크 관리자가 수동으로 등록해도 되지만, 자동으로 등록하는 것이 라우터 간에 경로 정보를 서로 교환하여 라우팅 테이블 정보로 자동으로 수정해주기 때문에 훨씬 더 편하다.

이처럼 라우터 간에 라우팅 정보를 교환하기 위한 프로토콜을 **라우팅 프로토콜**이라고 한다.

라우팅 프로토콜을 설정하여 라우터간에 경로 정보를 서로 교환하고 그것을 라우팅 테이블에 등록해 나가는 것이다.